<!DOCTYPE html>
<html layout:decorate="~{layout/layout.html}">
<head>
    <!-- 필요한 CSS 및 JS 파일 링크 추가 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- 사용자 정의 스타일 시트 링크 -->
    <link rel="stylesheet" href="/resource/product/detail.css"> <!-- CSS 파일 경로 설정 -->
</head>
<body>
<div layout:fragment="content" class="section-prod-list">
    <div class="container" >
        <div class="row">
            <!-- 왼쪽: 썸네일 이미지 -->
            <div class="col-md-7 d-flex justify-content-center align-items-center ">
                <img class="thumbnail-img" th:src="@{|/gen/${product.thumbnailImg}|}" style="height: 800px; width: 800px;" alt="상품 썸네일 이미지">
            </div>
            <!-- 오른쪽: 상품 설명 -->
            <div class="col-md-5 custom-col-md-5">
                <ul class="list-group list-group-flush gap-3">
                    <li class="list-group-item">
                        <span>번호 : </span>
                        <span th:text="${product.id}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>등록날짜 : </span>
                        <span th:text="${#temporals.format(product.createDate, 'yyyy-MM-dd HH:mm')}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>수정날짜 : </span>
                        <span th:text="${#temporals.format(product.modifyDate, 'yyyy-MM-dd HH:mm')}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>상품명 : </span>
                        <span class="font-bold" th:text="${product.title}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>상품설명 : </span>
                        <span th:text="${product.description}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>가격 : </span>
                        <span th:text="${#numbers.formatInteger(product.price, 3, 'COMMA') + '원'}"></span>
                    </li>
                    <li class="list-group-item">
                        <span>적립금 : </span>
                        <span th:text="${product.point} + '원'"></span>
                    </li>
                    <li class="list-group-item">
                        <span>마켓 : </span>
                        <span class="badge bg-dark">cod</span>
                    </li>
                    <li class="list-group-item">
                        <form id="add-to-cart-form" th:action="@{|/cart/add/${product.id}|}" method="POST" onsubmit="addToCartAndConfirm(event)">
                            <input type="submit" value="장바구니 담기" class="btn btn-outline-dark">
                        </form>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 상품 디테일 -->
        <div class="detail-imgs text-center">
            <h4>상품 디테일 이미지들:</h4>
            <div class="d-flex flex-wrap justify-content-center">
                <!-- 디테일 이미지 리스트를 반복하여 출력 -->
                <div th:each="detailImg : ${product.detailImgs}" class="p-2">
                    <img th:src="@{|/gen/${detailImg}|}" alt="상품 디테일 이미지">
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function addToCartAndConfirm(event) {
        event.preventDefault(); // 폼 제출을 방지합니다.
        const form = document.getElementById('add-to-cart-form');
        const action = form.getAttribute('action');

        fetch(action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(new FormData(form))
        })
        .then(response => {
            if (response.ok) {
                alert('상품이 장바구니에 추가되었습니다.');
                if (confirm('장바구니로 이동하시겠습니까?')) {
                    window.location.href = '/cart/list'; // 장바구니 페이지로 이동
                }
            } else {
                alert('상품을 장바구니에 추가하는 데 실패했습니다.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('상품을 장바구니에 추가하는 중 오류가 발생했습니다.');
        });
    }

    window.addEventListener('beforeunload', function() {
        sessionStorage.setItem('scrollPosition', window.scrollY);
    });

    window.addEventListener('load', function() {
        if (sessionStorage.getItem('scrollPosition')) {
            window.scrollTo(0, sessionStorage.getItem('scrollPosition'));
            sessionStorage.removeItem('scrollPosition');
        }
    });
</script>
</body>
</html>